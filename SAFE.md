### XSS 跨站脚本攻击
```markdown
 攻击者通过在目标网站上注入恶意脚本并运行，获取用户的敏感信息如（cookie， session）等，影响网站与用户数据安全。

本质是恶意代码未经过过滤，与网站正常的代码混在一起，浏览器无法分辨哪些脚本是可信的，导致恶意脚本执行。

XSS的攻击要素：
1、攻击者提交恶意代码
2、浏览器执行恶意代码

XSS攻击分类：
| 类型         |  存储区   |  插入点
| 反射弧型XSS   |  URL     |  HTML
| 存储型XSS     | 后端数据库 | HTML
| DOM型XSS     | 后端数据库/前端存储/URL | 前端JS

反射弧型XSS攻击
反射弧型XSS只是把用户输入的数据“反射”给浏览器，攻击者往往需要诱使用户操作一个恶意链接，才能攻击成功。反射弧型XSS也叫作“非持久型XSS”

存储型XSS
存储型XSS会把用户输入的数据“存储”在服务器端，这种XSS具有很强的稳定性
比较常见的一个场景就是，黑客写下一篇包含有恶意JS代码的博客文章，发表后，所有访问该博客文章的用户都会在他们的浏览器中执行这段恶意的JS代码。黑客把恶意的脚本保存到服务器端，所以这种XSS攻击就叫做“存储型XSS”
存储型XSS通常也叫作“持久型XSS”

DOM型XSS攻击
DOM型XSS攻击从效果上来说，也是反射弧型XSS，通过修改页面的DOM节点形成XSS，称之为DOM型XSS
实际上，这种类型的XSS并非按照“数据是否保存在服务器端”来划分，单独划分出来，是因为DOM型XSS的形成原因比较特别，发现它的安全专家专门提出了这种类型的XSS。

XSS攻击类别区别
存储型XSS的恶意代码存在数据库里，反射弧型XSS的恶意代码存在URL里
DOM型XSS攻击中，取出和执行恶意代码由浏览器端完成，输入前段JS自身的安全漏洞，而其他两种XSS都属于服务端的安全漏洞

XSS攻击检测
使用XSS攻击字符串手动检测XSS漏洞
使用扫描工具自动检测XSS漏洞 例如Arachni、Mozilla HTTP Observatory、w3af等

XSS攻击防御
1、输入输出检查
2、避免内联事件
3、富文本类使用标签白名单
4、增加攻击难度，降低攻击后果
5、增加验证码，防止脚本冒充用户提交危险操作
6、通过CSP、输入长度配置、接口安全措施等方法
7、主动检测发现

内容安全策略CSP (Content Security Policy)
1、禁止加载外域代码，防止复杂的攻击逻辑
2、禁止外域提交，网站被攻击后，用户的数据不会泄露到外域
3、禁止内联脚本执行
4、禁止未授权的脚本执行
5、合理使用上报可以及时发现XSS，利用尽快修复问题

```
### CSRF 跨站请求伪造
```markdown
攻击者盗用受害人的身份，以受害人的名义发送恶意请求。
本质是重要操作的所有参数都是可以被攻击者猜到的，攻击者只有预测出URL的所有参数与参数值，才能成功地构造一个伪造的请求；反之，攻击者将无法攻击成功。

CSRF攻击要素
1、攻击一般发起在第三方网站，被攻击的网站无法防止攻击发生
2、攻击利用受害者在被攻击网站的登陆凭证，冒充受害者提交操作，而不是直接窃取数据
3、整个过程攻击者并不能获取受害者登录凭证，只是冒用
4、跨站请求可以是图片URL，超链接，CORS，Form提交等

CSRF攻击防御 
1、阻止不明外域的访问
·同源检测
如何判断请求是否是来自于外域？
HTTP协议中，每一个异步请求都会携带两个header，用于标记来源域名： Origin header、referer header，这两个header在浏览器发起请求时，大多数情况会自动带上，并且不能由前端自定义内容，
服务器可以通过解析这两个header中的域名，确定请求的来源域。
· Samesite Cookie
Samesite Cookie是由Google起草的一份草案来改进HTTP协议，就是为set-cookie响应头新增sameSite属性，用来标明这个cookie是个“同站cookie”，同站cookie只能作为第一方cookie，不能作为第三方cookie，samesite有连个属性值，分别是strict和lax，
 samesite=strict：严格模式，表明这个cookie在任何情况下都不可能作为第三方cookie，绝无例外
 samesite=lax

2、提交时要求附加本域才能获取的信息
CSRF Token
· 将CSRF token输出在页面中
· 页面提交的请求携带这个token
· 服务器验证token是否正确
双重cookie验证
· 用户访问网站页面时，向请求域名注入一个cookie，前端向后端发起请求时，取出cookie，添加到URL的参数中，后端接口验证cookie中的字段与URL参数中
的字段是否一致，不一致则拒绝
· 优点： 无需使用session，适用面广，易于实施。token储存于客户端中，不会给服务器带来压力。相对于token，实施成本更低，可以在前后端统一拦截校验，而不需要一个个接口和页面添加。
· 缺点：cookie中增加了额外的字段；如果有其他漏洞（例如XSS），攻击者可以注入cookie，那么该防御方式有效。难以做到子域名对的隔离。为了确保cookie传输安全，采用这种防御方式的最好确保用征战HTTPS的方式，
如果还没切HTTPS的使用这种方式也会有风险。

CSRF测试
1、设置浏览器代理
2、使用合法账号访问网站开始测试
3、通过CSRF修改并伪造请求
4、拿到结果如有漏洞进行修复
```